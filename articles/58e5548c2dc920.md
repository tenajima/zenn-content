---
title: "[お蔵入り]dbt cloudのCIのコスト削減、そしてArtifactsとは何者なのか"
emoji: "🐙"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

# はじめに

この記事は10Xのアドベントカレンダー○日目の記事です。

# どのような問題を解決したかったのか

- データ基盤のCIで開発した部分と関係ないモデルも動いていることによるスキャンコスト、(CIを待っている間の)時間的コスト
- 組織状況的にアナリストがマート層に対してPull Requestをたくさん上げてくれることになり、上記の課題がさらに大きくなりそうだった

というのを解決したいと思いました。

# どう解決するか

世の中の人誰か考えているだろうと検索したら、さがらさんがとても分かりやすくまとめてくださっていたので詳しくはそちらを参照してください。
https://dev.classmethod.jp/articles/dbt-cloud-ci-job-only-modified-model/

# どのような結果をもたらしたか

CIには15分ほどかかっていました。PRを作成したタイミングとそのPRを修正したタイミングでその15分が必要となっていました。

一人で作業する分には一息つくのにちょうどいい時間かもしれませんが、この時間がデータ基盤に関わる人が増えるほどかかってしまうとチリツモで大きな時間になります。
また、再度Big Queryに投げるクエリ量も無視できない量になっていくかもしれません。

結果的にこの対応で1分でCIが完了することが増えました。見事CI効率10x達成！
もちろん差分が多いと実行時間は長いですが、無駄なくCIが回せるようになったというのは心理的にはとても安らかなものです。

# Artifactsとは何者か
さがらさんの記事への紹介を貼るだけだと何のブログか分からないのでもう少し深掘ります。
CIを見ていると、「どうしてここも実行されているのかな？」ということもあったので、dbtは何を差分として認識しているのかを実験とともに深ぼっていきます。
https://docs.getdbt.com/reference/node-selection/state-comparison-caveats

